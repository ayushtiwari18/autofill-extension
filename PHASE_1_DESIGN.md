# PHASE 1 - EXTENSION SKELETON (DESIGN)

## Module Responsibilities

### 1. manifest.json
**Responsibility**: Extension configuration and permissions
**Inputs**: None
**Outputs**: Chrome extension metadata
**Key Decisions**:
- Manifest version: 3
- Permissions: `["storage", "activeTab", "scripting"]`
- Action: Browser popup
- Background: Service worker type
- Content scripts: Defined but not injected automatically (use scripting API)

### 2. package.json
**Responsibility**: Dependency management and build scripts
**Inputs**: None
**Outputs**: NPM configuration
**Key Decisions**:
- React: ^18.2.0 (stable, no experimental features)
- Webpack: ^5.88.0 (standard bundler)
- Babel: For JSX transformation
- No TypeScript
- No unnecessary UI libraries

### 3. webpack.config.js
**Responsibility**: Bundle React components and scripts
**Inputs**: src/ files
**Outputs**: dist/ bundled files
**Key Decisions**:
- Entry points: popup, background, content
- Output: dist/ folder
- Mode: production (for initial testing)
- Dev mode: development (for iteration)

### 4. public/index.html
**Responsibility**: Popup UI container
**Inputs**: None
**Outputs**: HTML DOM for React mounting
**Key Decisions**:
- Single div with id="root"
- No inline scripts (CSP compliance)
- Link to bundled popup.js

## Data Flow

```
User Action
    ↓
[Popup UI] <─── React renders
    ↓
[Extension loaded]
    ↓
[Service Worker] <─── Listens for events
    ↓
[Content Script] <─── Not active yet (Phase 3)
```

### Phase 1 Flow (Minimal)
1. User clicks extension icon
2. Chrome loads popup.html
3. React mounts to #root
4. Shows "Hello World" (verification only)

## Interfaces Between Modules

### Webpack → Manifest
- Webpack outputs: `dist/popup.js`, `dist/background.js`, `dist/content.js`
- Manifest references: These exact paths

### Popup HTML → React
- HTML provides: `<div id="root"></div>`
- React attaches: Via `ReactDOM.createRoot()`

### Package.json → Webpack
- Scripts: `npm run build` → `webpack --mode production`
- Scripts: `npm run dev` → `webpack --mode development --watch`

## Error Handling Approach

### Build Errors
- Webpack fails → Check console output
- React syntax error → Babel configuration issue
- **Action**: Fix before continuing, no broken builds

### Load Errors
- Extension won't load → Validate manifest.json
- Popup won't open → Check HTML path in manifest
- **Action**: Use chrome://extensions to diagnose

### Validation
- JSON files: Use online validators
- Manifest: Use Chrome's extension validator
- Build output: Check dist/ folder structure

## Security Checks

### Manifest Security
- ✅ No `"<all_urls>"` permission
- ✅ No `"webRequest"` permission (not needed)
- ✅ No host permissions yet
- ✅ CSP: Default is sufficient (no unsafe-eval, no inline scripts)

### Build Security
- ✅ No external CDN dependencies
- ✅ All code bundled locally
- ✅ No environment variables exposed

## Validation Against SRS

✅ **Manifest V3**: Using latest standard
✅ **JavaScript**: No TypeScript
✅ **React**: Only for popup UI
✅ **No backend**: All client-side
✅ **Folder structure**: Matches specification
✅ **No overengineering**: Minimal dependencies

## Minimal Complexity Check

### Dependencies (Justified)
1. **react** + **react-dom**: Required for UI (specified)
2. **webpack** + **webpack-cli**: Bundler (necessary)
3. **babel-loader** + presets: JSX transformation (necessary)
4. **html-webpack-plugin**: Generates HTML (optional but useful)

### Alternative Considered: Vite
- Rejected: Webpack more standard for extensions
- Reason: Better control over multi-entry builds

## File Structure After Phase 1

```
/autofill-extension
 ├── dist/                  # Generated by webpack
 │   ├── popup.js
 │   ├── background.js
 │   └── content.js
 ├── public/
 │   ├── index.html        # Popup HTML
 │   ├── icon16.png        # Placeholder
 │   ├── icon48.png        # Placeholder
 │   └── icon128.png       # Placeholder
 ├── src/
 │   ├── ui/
 │   │   └── Popup.jsx     # Minimal React component
 │   ├── background/
 │   │   └── serviceWorker.js  # Empty for now
 │   ├── content/
 │   │   └── scanner.js    # Empty for now
 │   └── index.js          # React entry point
 ├── manifest.json
 ├── package.json
 ├── webpack.config.js
 └── README.md
```

## Design Decisions Summary

| Decision | Rationale | Alternative Rejected |
|----------|-----------|---------------------|
| Webpack over Vite | Better multi-entry control | Vite (less extension experience) |
| Babel for JSX | Standard React transformation | SWC (less mature) |
| No dev server | Extension reloads manually | Webpack dev server (complex for extensions) |
| Minimal permissions | Security-first approach | Request more later if needed |
| No content_scripts auto-inject | Use scripting API for control | Auto-inject (less flexible) |

## Ready for Implementation

✅ All modules defined
✅ Data flow clear
✅ Interfaces specified
✅ Error handling planned
✅ Security validated
✅ Complexity minimized
✅ No ambiguities

---

**Status**: Design Complete ✅
**Blockers**: None
**Ready for Implementation**: YES
**Next**: Create files in atomic commits